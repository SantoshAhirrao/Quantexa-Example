#!/bin/bash -x

set -e
exec >&2

echo compiling software ...

if [ -z "$WORKSPACE" ]
then
    WORKSPACE=`dirname $0`/..
fi
cd $WORKSPACE

echo "Adding account records..."
curl -XPOST "elastic.toothless.svc.cluster.local:9200/_bulk" -H 'Content-Type: application/json' -d'
{"create":{"_index":"ci-test-resolver-customer-account","_type":"default","_id":"/customerIdNumberString[29986986656]/primaryAccountNumber[22577981297995]"}}
{"document_type":"customer","document_id":"29986986656","entity_type":"account","attributes":{"compositeAccountName":["AsianSolutionsEE"],"accountOpenedDate":[632275200000],"relationalManagerName":["MONNIESAMMS"],"label":["22577981297995"],"accountStatus":["Active"],"amlALRFlag":["f"],"accountClosedDate":[670806000000],"accountRiskRating":["6047.0"]},"compounds":{"primaryAccountNumber":["22577981297995"]},"run_id":"1","id":"/customerIdNumberString[29986986656]/primaryAccountNumber[22577981297995]"}
{"create":{"_index":"ci-test-resolver-customer-account","_type":"default","_id":"/customerIdNumberString[29986986656]/primaryAccountNumber[89410067208138]"}}
{"document_type":"customer","document_id":"29986986656","entity_type":"account","attributes":{"compositeAccountName":["AsianSolutionsEE"],"accountOpenedDate":[632275200000],"relationalManagerName":["IDALIASILVERA"],"label":["89410067208138"],"accountStatus":["Active"],"amlALRFlag":["f"],"accountClosedDate":[670806000000],"accountRiskRating":["1829.0"]},"compounds":{"primaryAccountNumber":["89410067208138"]},"run_id":"1","id":"/customerIdNumberString[29986986656]/primaryAccountNumber[89410067208138]"}
'

echo "Adding address records..."
curl -XPOST "elastic.toothless.svc.cluster.local:9200/_bulk" -H 'Content-Type: application/json' -d'
{"create":{"_index":"ci-test-resolver-customer-address","_type":"default","_id":"/customerIdNumberString[29986986656]/primaryAccountNumber[22577981297995]"}}
{"document_type":"customer","document_id":"29986986656","entity_type":"address","attributes":{"addressDisplay":["40BayviewClose,CASTLECREEK,QLD,4715"],"postcode":["4715"]},"compounds":{"houseNumberOrHouseNameOrPOBox_road_postcode":["40¬BAYVIEWCLOSE¬4715"],"houseNumberOrHouseNameOrPOBox_road_city_state":["40¬BAYVIEWCLOSE¬CASTLECREEK¬QLD"],"flatAndHouseNumberOrNameOrPOBox_road_city":["|40¬BAYVIEWCLOSE¬CASTLECREEK"],"houseNumberOrHouseNameOrPOBox_road_city":["40¬BAYVIEWCLOSE¬CASTLECREEK"],"flatAndHouseNumberOrNameOrPOBox_postcode":["|40¬4715"],"flatAndHouseNumberOrNameOrPOBox_road_postcode":["|40¬BAYVIEWCLOSE¬4715"],"houseNumberOrHouseNameOrPOBox_postcode":["40¬4715"],"flatAndHouseNumberOrNameOrPOBox_road_city_state":["|40¬BAYVIEWCLOSE¬CASTLECREEK¬QLD"]},"run_id":"1","id":"/customerIdNumberString[29986986656]/primaryAccountNumber[22577981297995]"}
{"create":{"_index":"ci-test-resolver-customer-address","_type":"default","_id":"/customerIdNumberString[29986986656]"}}
{"document_type":"customer","document_id":"29986986656","entity_type":"address","attributes":{"addressDisplay":["40BayviewClose,CASTLECREEK,QLD,4715"],"postcode":["4715"]},"compounds":{"houseNumberOrHouseNameOrPOBox_road_postcode":["40¬BAYVIEWCLOSE¬4715"],"houseNumberOrHouseNameOrPOBox_road_city_state":["40¬BAYVIEWCLOSE¬CASTLECREEK¬QLD"],"flatAndHouseNumberOrNameOrPOBox_road_city":["|40¬BAYVIEWCLOSE¬CASTLECREEK"],"houseNumberOrHouseNameOrPOBox_road_city":["40¬BAYVIEWCLOSE¬CASTLECREEK"],"flatAndHouseNumberOrNameOrPOBox_postcode":["|40¬4715"],"flatAndHouseNumberOrNameOrPOBox_road_postcode":["|40¬BAYVIEWCLOSE¬4715"],"houseNumberOrHouseNameOrPOBox_postcode":["40¬4715"],"flatAndHouseNumberOrNameOrPOBox_road_city_state":["|40¬BAYVIEWCLOSE¬CASTLECREEK¬QLD"]},"run_id":"1","id":"/customerIdNumberString[29986986656]"}
{"create":{"_index":"ci-test-resolver-customer-address","_type":"default","_id":"/customerIdNumberString[29986986656]/primaryAccountNumber[89410067208138]"}}
{"document_type":"customer","document_id":"29986986656","entity_type":"address","attributes":{"addressDisplay":["40BayviewClose,CASTLECREEK,QLD,4715"],"postcode":["4715"]},"compounds":{"houseNumberOrHouseNameOrPOBox_road_postcode":["40¬BAYVIEWCLOSE¬4715"],"houseNumberOrHouseNameOrPOBox_road_city_state":["40¬BAYVIEWCLOSE¬CASTLECREEK¬QLD"],"flatAndHouseNumberOrNameOrPOBox_road_city":["|40¬BAYVIEWCLOSE¬CASTLECREEK"],"houseNumberOrHouseNameOrPOBox_road_city":["40¬BAYVIEWCLOSE¬CASTLECREEK"],"flatAndHouseNumberOrNameOrPOBox_postcode":["|40¬4715"],"flatAndHouseNumberOrNameOrPOBox_road_postcode":["|40¬BAYVIEWCLOSE¬4715"],"houseNumberOrHouseNameOrPOBox_postcode":["40¬4715"],"flatAndHouseNumberOrNameOrPOBox_road_city_state":["|40¬BAYVIEWCLOSE¬CASTLECREEK¬QLD"]},"run_id":"1","id":"/customerIdNumberString[29986986656]/primaryAccountNumber[89410067208138]"}
'

echo "Adding business records..."
curl -XPOST "elastic.toothless.svc.cluster.local:9200/_bulk" -H 'Content-Type: application/json' -d'
{"create":{"_index":"ci-test-resolver-customer-business","_type":"default","_id":"/customerIdNumberString[29986986656]"}}
{"document_type":"customer","document_id":"29986986656","entity_type":"business","attributes":{"registeredBusinessNumber":["955563322"],"businessLeftDate":[670806000000],"countryOfRegisteredBusiness":["MF"],"businessNameDisplay":["AsianSolutionsEE"],"registeredBusinessName":["AsianSolutionsEE"],"businessJoinedDate":[632275200000]},"compounds":{"registeredBusinessNumber":["955563322"],"businessNameClean_postcode":["ASIAN¬4715"],"businessNameClean_road_postcode":["ASIAN¬BAYVIEWCLOSE¬4715"],"businessNameClean_telephone":["ASIAN¬0749331518"],"businessNameClean_road":["ASIAN¬BAYVIEWCLOSE"],"primaryAccountNumber":["ASIAN¬22577981297995","ASIAN¬89410067208138"],"businessName":["ASIANSOLUTIONSEE"],"businessNameClean_city":["ASIAN¬CASTLECREEK"],"businessNameClean":["ASIAN"]},"run_id":"1","id":"/customerIdNumberString[29986986656]"}
'

echo "Adding telephone records..."
curl -XPOST "elastic.toothless.svc.cluster.local:9200/_bulk" -H 'Content-Type: application/json' -d'
{"create":{"_index":"ci-test-resolver-customer-telephone","_type":"default","_id":"/customerIdNumberString[29986986656]/primaryAccountNumber[22577981297995]"}}
{"document_type":"customer","document_id":"29986986656","entity_type":"telephone","attributes":{"telephoneDisplay":["(07)49331518"]},"compounds":{"telephoneClean":["0749331518"]},"run_id":"1","id":"/customerIdNumberString[29986986656]/primaryAccountNumber[22577981297995]"}
{"create":{"_index":"ci-test-resolver-customer-telephone","_type":"default","_id":"/customerIdNumberString[29986986656]/primaryAccountNumber[89410067208138]"}}
{"document_type":"customer","document_id":"29986986656","entity_type":"telephone","attributes":{"telephoneDisplay":["(07)49331518"]},"compounds":{"telephoneClean":["0749331518"]},"run_id":"1","id":"/customerIdNumberString[29986986656]/primaryAccountNumber[89410067208138]"}
'

echo "Adding doc2rec records..."
curl -XPOST "elastic.toothless.svc.cluster.local:9200/_bulk" -H 'Content-Type: application/json' -d'
{"create":{"_index":"ci-test-resolver-customer-doc2rec","_type":"default","_id":"29986986656"}}
{"document_type": "customer","document_id":"29986986656","attributes":{"label":"29986986656","customerEndDate":670806000000,"residenceCountry":"AU","customerStartDate":632275200000},"records":[{"id":"/customerIdNumberString[29986986656]/primaryAccountNumber[22577981297995]","entityType":"address"},{"id":"/customerIdNumberString[29986986656]/primaryAccountNumber[89410067208138]","entityType":"address"},{"id":"/customerIdNumberString[29986986656]","entityType":"address"},{"id":"/customerIdNumberString[29986986656]/primaryAccountNumber[22577981297995]","entityType":"account"},{"id":"/customerIdNumberString[29986986656]/primaryAccountNumber[89410067208138]","entityType":"account"},{"id":"/customerIdNumberString[29986986656]/primaryAccountNumber[22577981297995]","entityType":"telephone"},{"id":"/customerIdNumberString[29986986656]/primaryAccountNumber[89410067208138]","entityType":"telephone"},{"id":"/customerIdNumberString[29986986656]","entityType":"business"}],"run_id":"1"}
'

echo "Adding search records..."
curl -XPOST "elastic.toothless.svc.cluster.local:9200/_bulk" -H 'Content-Type: application/json' -d'
{"create":{"_index":"ci-test-search-customer","_type":"default","_id":"29986986656"}}
{"customerIdNumberString":"29986986656","customerIdNumber":29986986656,"parsedAddress":{"houseNumber":"40","city":"CASTLECREEK","addressDisplay":"40BayviewClose,CASTLECREEK,QLD,4715","state":"QLD","postcode":"4715","road":"BAYVIEWCLOSE","houseNumberHouseName":"40","flatNumberHouseNumberHouseName":"|40"},"customerEndDate":670806000000,"consolidatedCustomerAddress":"40BayviewClose,CASTLECREEK,QLD,4715","customerStartDate":632275200000,"parsedBusinessName":{"businessDisplay":"AsianSolutionsEE","businessName":"ASIANSOLUTIONSEE","businessNameClean":["ASIAN"]},"accounts":[{"rawAccountName":"AsianSolutionsEE","accountLinkEndDate":670806000000,"city":"CASTLECREEK","compositeAccountName":"AsianSolutionsEE","telephoneNumber":"(07)49331518","accountOpenedDate":632275200000,"relationalManagerName":"MONNIESAMMS","state":"AU","accountCustomerIdNumber":29986986656,"postcode":"4715","dataSourceCountry":"AU","addressLineOne":"40BayviewClose","accountDistrict":"CASTLECREEK","country":"AU","accountStatus":"Active","amlALRFlag":"f","primaryAccountNumber":22577981297995,"consolidatedAccountAddress":"40BayviewClose,CASTLECREEK,QLD,4715","parsedAddress":{"houseNumber":"40","city":"CASTLECREEK","addressDisplay":"40BayviewClose,CASTLECREEK,QLD,4715","state":"QLD","postcode":"4715","road":"BAYVIEWCLOSE","houseNumberHouseName":"40","flatNumberHouseNumberHouseName":"|40"},"dataSourceCode":"CUSTACCTLINK","accountClosedDate":670806000000,"cleansedTelephoneNumber":{"telephoneDisplay":"(07)49331518","telephoneClean":"0749331518"},"accountLinkCreatedDate":632275200000,"accountRiskRating":6047},{"rawAccountName":"AsianSolutionsEE","accountLinkEndDate":670806000000,"city":"CASTLECREEK","compositeAccountName":"AsianSolutionsEE","telephoneNumber":"(07)49331518","accountOpenedDate":632275200000,"relationalManagerName":"IDALIASILVERA","state":"AU","accountCustomerIdNumber":29986986656,"postcode":"4715","dataSourceCountry":"AU","addressLineOne":"40BayviewClose","accountDistrict":"CASTLECREEK","country":"AU","accountStatus":"Active","amlALRFlag":"f","primaryAccountNumber":89410067208138,"consolidatedAccountAddress":"40BayviewClose,CASTLECREEK,QLD,4715","parsedAddress":{"houseNumber":"40","city":"CASTLECREEK","addressDisplay":"40BayviewClose,CASTLECREEK,QLD,4715","state":"QLD","postcode":"4715","road":"BAYVIEWCLOSE","houseNumberHouseName":"40","flatNumberHouseNumberHouseName":"|40"},"dataSourceCode":"CUSTACCTLINK","accountClosedDate":670806000000,"cleansedTelephoneNumber":{"telephoneDisplay":"(07)49331518","telephoneClean":"0749331518"},"accountLinkCreatedDate":632275200000,"accountRiskRating":1829}],"document_type":"customer","customerStatus":"C","parsedCustomerName":[],"metaData":{"runId":"2019-03-18_13-28-27-14","currentRunTime":"2019-03-1813:29:56.506","runHash":"544b75960f4cbfa11fe078d93d3d5ef3e8f55d011df19e821090320eb345bf5c"},"countryOfRegisteredBusiness":"MF","registeredBusinessNumber":955563322,"registeredBusinessName":"AsianSolutionsEE","personalBusinessFlag":"B","residenceCountry":"AU","_records":[{"path":"accounts","offset":0,"records":[{"id":"/customerIdNumberString[29986986656]/primaryAccountNumber[22577981297995]","entityType":"address"}]},{"path":"accounts","offset":1,"records":[{"id":"/customerIdNumberString[29986986656]/primaryAccountNumber[89410067208138]","entityType":"address"}]},{"path":"","offset":0,"records":[{"id":"/customerIdNumberString[29986986656]","entityType":"address"}]},{"path":"accounts","offset":0,"records":[{"id":"/customerIdNumberString[29986986656]/primaryAccountNumber[22577981297995]","entityType":"account"}]},{"path":"accounts","offset":1,"records":[{"id":"/customerIdNumberString[29986986656]/primaryAccountNumber[89410067208138]","entityType":"account"}]},{"path":"accounts","offset":0,"records":[{"id":"/customerIdNumberString[29986986656]/primaryAccountNumber[22577981297995]","entityType":"telephone"}]},{"path":"accounts","offset":1,"records":[{"id":"/customerIdNumberString[29986986656]/primaryAccountNumber[89410067208138]","entityType":"telephone"}]},{"path":"","offset":0,"records":[{"id":"/customerIdNumberString[29986986656]","entityType":"business"}]}]}
'